<h1>Productos en Tiempo Real</h1>

<div style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem; margin-bottom: 2rem;">
    <div id="products-container">
        <p>Cargando productos...</p>
    </div>
    
    <div style="background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); height: fit-content;">
        <h3 style="color: #667eea; margin-bottom: 1rem;">Agregar Producto</h3>
        <form id="productForm">
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.3rem; font-weight: 500;">Título</label>
                <input type="text" name="title" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.3rem; font-weight: 500;">Descripción</label>
                <textarea name="description" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; font-family: inherit;"></textarea>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.3rem; font-weight: 500;">Código</label>
                <input type="text" name="code" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.3rem; font-weight: 500;">Precio</label>
                <input type="number" name="price" step="0.01" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.3rem; font-weight: 500;">Stock</label>
                <input type="number" name="stock" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.3rem; font-weight: 500;">Categoría</label>
                <input type="text" name="category" required style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
            </div>
            
            <button type="submit" style="width: 100%; padding: 0.75rem; background: #667eea; color: white; border: none; border-radius: 4px; font-weight: 500; cursor: pointer; transition: background 0.3s;">
                Crear Producto
            </button>
        </form>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    
    // Conectar y cargar productos
    socket.on('loadProducts', (products) => {
        renderProducts(products);
    });
    
    // Escuchar nuevo producto
    socket.on('productAdded', (product) => {
        addProductToDOM(product);
    });
    
    // Escuchar eliminación de producto
    socket.on('productDeleted', (productId) => {
        removeProductFromDOM(productId);
    });
    
    // Manejar errores
    socket.on('error', (error) => {
        alert('Error: ' + error);
    });
    
    function renderProducts(products) {
        const container = document.getElementById('products-container');
        
        if (!products || products.length === 0) {
            container.innerHTML = '<p style="color: #999;">No hay productos disponibles</p>';
            return;
        }
        
        container.innerHTML = '';
        products.forEach(product => {
            addProductToDOM(product);
        });
    }
    
    function addProductToDOM(product) {
        const container = document.getElementById('products-container');
        
        if (container.innerHTML.includes('No hay productos')) {
            container.innerHTML = '';
        }
        
        const productHTML = `
            <div id="product-${product.id}" style="background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <h3 style="color: #667eea; margin-bottom: 0.5rem;">${product.title}</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">${product.description}</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <p><strong>Código:</strong> ${product.code}</p>
                            <p><strong>Precio:</strong> $${product.price}</p>
                            <p><strong>Stock:</strong> ${product.stock}</p>
                            <p><strong>Categoría:</strong> ${product.category}</p>
                        </div>
                    </div>
                    <button onclick="deleteProduct(${product.id})" style="background: #f44336; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-left: 1rem; white-space: nowrap;">
                        Eliminar
                    </button>
                </div>
            </div>
        `;
        
        container.insertAdjacentHTML('beforeend', productHTML);
    }
    
    function removeProductFromDOM(productId) {
        const element = document.getElementById(`product-${productId}`);
        if (element) {
            element.remove();
        }
        
        const container = document.getElementById('products-container');
        if (container.children.length === 0) {
            container.innerHTML = '<p style="color: #999;">No hay productos disponibles</p>';
        }
    }
    
    // Manejar envío del formulario
    document.getElementById('productForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const productData = {
            title: formData.get('title'),
            description: formData.get('description'),
            code: formData.get('code'),
            price: parseFloat(formData.get('price')),
            stock: parseInt(formData.get('stock')),
            category: formData.get('category')
        };
        
        // Enviar a través de Socket.io
        socket.emit('addProduct', productData);
        
        // Limpiar formulario
        e.target.reset();
    });
    
    function deleteProduct(productId) {
        if (confirm('¿Estás seguro de que deseas eliminar este producto?')) {
            socket.emit('deleteProduct', productId);
        }
    }
</script>
